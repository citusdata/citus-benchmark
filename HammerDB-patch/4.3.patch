--- HammerDB-4.3-upstream/src/postgresql/pgoltp.tcl	2021-12-09 16:30:42.699719464 +0100
+++ HammerDB-4.3/src/postgresql/pgoltp.tcl	2021-12-10 14:02:02.470955269 +0100
@@ -455,9 +455,11 @@
 WHEN serialization_failure OR deadlock_detected OR no_data_found
 THEN ROLLBACK;
 END; }
-for { set i 1 } { $i <= 6 } { incr i } {
+set sql(7) { SELECT create_distributed_function('dbms_random(int,int)') }
+set sql(8) { SELECT create_distributed_function(oid, '$1', colocate_with:='warehouse') FROM pg_catalog.pg_proc WHERE proname IN ('neword', 'delivery', 'payment', 'ostat', 'slev') }
+for { set i 1 } { $i <= 8 } { incr i } {
 set result [ pg_exec $lda $sql($i) ]
-if {[pg_result $result -status] != "PGRES_COMMAND_OK"} {
+if {[pg_result $result -status] ni {"PGRES_TUPLES_OK" "PGRES_COMMAND_OK"}} {
 error "[pg_result $result -error]"
 	} else {
 pg_result $result -clear
@@ -1551,9 +1553,11 @@
 ' LANGUAGE 'plpgsql';
 	}
     }
-for { set i 1 } { $i <= 6 } { incr i } {
+set sql(7) { SELECT create_distributed_function('dbms_random(int,int)') }
+set sql(8) { SELECT create_distributed_function(oid, '$1', colocate_with:='warehouse') FROM pg_catalog.pg_proc WHERE proname IN ('neword', 'delivery', 'payment', 'ostat', 'slev') }
+for { set i 1 } { $i <= 8 } { incr i } {
 set result [ pg_exec $lda $sql($i) ]
-if {[pg_result $result -status] != "PGRES_COMMAND_OK"} {
+if {[pg_result $result -status] ni {"PGRES_TUPLES_OK" "PGRES_COMMAND_OK"}} {
 error "[pg_result $result -error]"
 	} else {
 pg_result $result -clear
@@ -1669,9 +1673,18 @@
 set sql(9) "CREATE TABLE ORDER_LINE (OL_DELIVERY_D TIMESTAMP WITH TIME ZONE, OL_O_ID INTEGER NOT NULL, OL_W_ID INTEGER NOT NULL, OL_I_ID INTEGER NOT NULL, OL_SUPPLY_W_ID INTEGER NOT NULL, OL_D_ID SMALLINT NOT NULL, OL_NUMBER SMALLINT NOT NULL, OL_QUANTITY SMALLINT NOT NULL, OL_AMOUNT NUMERIC(6,2), OL_DIST_INFO CHARACTER(24), CONSTRAINT ORDER_LINE_I1 PRIMARY KEY (OL_W_ID, OL_D_ID, OL_O_ID, OL_NUMBER)) PARTITION BY HASH (OL_W_ID)"
 		}
 	}
-for { set i 1 } { $i <= 9 } { incr i } {
+set sql(10) "SELECT create_distributed_table('customer', 'c_w_id')"
+set sql(11) "SELECT create_distributed_table('district', 'd_w_id')"
+set sql(12) "SELECT create_distributed_table('history', 'h_w_id')"
+set sql(13) "SELECT create_distributed_table('warehouse', 'w_id')"
+set sql(14) "SELECT create_distributed_table('stock', 's_w_id')"
+set sql(15) "SELECT create_distributed_table('new_order', 'no_w_id')"
+set sql(16) "SELECT create_distributed_table('orders', 'o_w_id')"
+set sql(17) "SELECT create_distributed_table('order_line', 'ol_w_id')"
+set sql(18) "SELECT create_reference_table('item')"
+for { set i 1 } { $i <= 18 } { incr i } {
 set result [ pg_exec $lda $sql($i) ]
-if {[pg_result $result -status] != "PGRES_COMMAND_OK"} {
+if {[pg_result $result -status] ni {"PGRES_TUPLES_OK" "PGRES_COMMAND_OK"}} {
 error "[pg_result $result -error]"
 	} else {
 pg_result $result -clear
@@ -2099,7 +2112,7 @@
 if { $lda eq "Failed" } {
 error "error, the database connection to $host could not be established"
  } else {
-CreateUserDatabase $lda $host $port $sslmode $db $tspace $superuser $superuser_password $user $password
+#CreateUserDatabase $lda $host $port $sslmode $db $tspace $superuser $superuser_password $user $password
 set result [ pg_exec $lda "commit" ]
 pg_result $result -clear
 pg_disconnect $lda
